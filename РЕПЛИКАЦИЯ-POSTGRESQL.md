# –†–µ–ø–ª–∏–∫–∞—Ü–∏—è PostgreSQL –Ω–∞ Render

## üéØ –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç?

–î–≤–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ–¥–Ω–∞:
- **Primary (–≥–ª–∞–≤–Ω–∞—è)** - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏
- **Replica (—Ä–µ–ø–ª–∏–∫–∞)** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Primary

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ Render

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ –≤—Ç–æ—Ä—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

1. –ù–∞ Render —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
2. –ù–∞–∑–æ–≤–∏—Ç–µ –µ—ë, –Ω–∞–ø—Ä–∏–º–µ—Ä: `nelondlc-db-replica`
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ—Ç –∂–µ —Ä–µ–≥–∏–æ–Ω, —á—Ç–æ –∏ Primary –±–∞–∑–∞

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, **Render –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é** –º–µ–∂–¥—É –±–∞–∑–∞–º–∏ –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º –ø–ª–∞–Ω–µ.

## üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –±–∞–∑—É (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

Render PostgreSQL —É–∂–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
- –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
- –í—ã—Å–æ–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

**–í—ã–≤–æ–¥:** –í–∞–º –Ω–µ –Ω—É–∂–Ω–∞ –≤—Ç–æ—Ä–∞—è –±–∞–∑–∞! –û–¥–Ω–æ–π –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–ï—Å–ª–∏ –≤—Å—ë –∂–µ –Ω—É–∂–Ω—ã 2 –±–∞–∑—ã, –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é:

```javascript
// sync-databases.js
import pg from 'pg'
import dotenv from 'dotenv'

dotenv.config()

const { Pool } = pg

const primaryPool = new Pool({
  connectionString: process.env.DATABASE_URL_PRIMARY,
  ssl: { rejectUnauthorized: false }
})

const replicaPool = new Pool({
  connectionString: process.env.DATABASE_URL_REPLICA,
  ssl: { rejectUnauthorized: false }
})

async function syncDatabases() {
  console.log('üîÑ –ù–∞—á–∞–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...')
  
  try {
    // –ö–æ–ø–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    const users = await primaryPool.query('SELECT * FROM users')
    
    for (const user of users.rows) {
      await replicaPool.query(`
        INSERT INTO users (id, uid, username, email, password_hash, avatar_url, 
                          is_admin, license_key, created_at, last_login, plan, 
                          status, subscription_tier, subscription_expires_at, hwid)
        VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15)
        ON CONFLICT (id) DO UPDATE SET
          username = EXCLUDED.username,
          email = EXCLUDED.email,
          password_hash = EXCLUDED.password_hash,
          avatar_url = EXCLUDED.avatar_url,
          is_admin = EXCLUDED.is_admin,
          license_key = EXCLUDED.license_key,
          last_login = EXCLUDED.last_login,
          plan = EXCLUDED.plan,
          status = EXCLUDED.status,
          subscription_tier = EXCLUDED.subscription_tier,
          subscription_expires_at = EXCLUDED.subscription_expires_at,
          hwid = EXCLUDED.hwid
      `, [
        user.id, user.uid, user.username, user.email, user.password_hash,
        user.avatar_url, user.is_admin, user.license_key, user.created_at,
        user.last_login, user.plan, user.status, user.subscription_tier,
        user.subscription_expires_at, user.hwid
      ])
    }
    
    console.log(`‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${users.rows.length}`)
    
    // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü...
    
    console.log('‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!')
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:', error.message)
  } finally {
    await primaryPool.end()
    await replicaPool.end()
  }
}

syncDatabases()
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –í .env –¥–æ–±–∞–≤—å—Ç–µ:
DATABASE_URL_PRIMARY=postgresql://...
DATABASE_URL_REPLICA=postgresql://...

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é:
node sync-databases.js
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

–°–µ—Ä–≤–∏—Å—ã —Ç–∏–ø–∞ **Supabase** –∏–ª–∏ **Neon** –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é.

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–Ω—É –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Render:**

‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
‚úÖ –í—ã—Å–æ–∫–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å
‚úÖ –ü—Ä–æ—â–µ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
‚úÖ –î–µ—à–µ–≤–ª–µ

Render PostgreSQL —É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞–¥–µ–∂–µ–Ω –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

## üîí –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω Render** - –±–æ–ª—å—à–µ –±—ç–∫–∞–ø–æ–≤
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö** - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –¥–∞–º–ø –ë–î
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Render + –≤–Ω–µ—à–Ω–∏–π –±—ç–∫–∞–ø** - –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ S3

### –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±—ç–∫–∞–ø–∞:

```javascript
// backup-database.js
import { exec } from 'child_process'
import { promisify } from 'util'
import dotenv from 'dotenv'

dotenv.config()

const execAsync = promisify(exec)

async function backupDatabase() {
  const timestamp = new Date().toISOString().replace(/[:.]/g, '-')
  const filename = `backup-${timestamp}.sql`
  
  console.log('üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞...')
  
  try {
    await execAsync(`pg_dump "${process.env.DATABASE_URL}" > ${filename}`)
    console.log(`‚úÖ –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω: ${filename}`)
  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞:', error.message)
  }
}

backupDatabase()
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤

| –í–∞—Ä–∏–∞–Ω—Ç | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|---------|-----------|------------|-----------|
| –û–¥–Ω–∞ –±–∞–∑–∞ Render | ‚≠ê –õ–µ–≥–∫–æ | ‚≠ê‚≠ê‚≠ê‚≠ê –í—ã—Å–æ–∫–∞—è | $ –î–µ—à–µ–≤–æ |
| –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è | ‚≠ê‚≠ê‚≠ê –°–ª–æ–∂–Ω–æ | ‚≠ê‚≠ê –°—Ä–µ–¥–Ω—è—è | $$ –°—Ä–µ–¥–Ω–µ |
| –í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å | ‚≠ê‚≠ê –°—Ä–µ–¥–Ω–µ | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | $$$ –î–æ—Ä–æ–≥–æ |

## üéØ –ò—Ç–æ–≥

**–î–ª—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Render.**

Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –î–µ–ª–∞–µ—Ç –±—ç–∫–∞–ø—ã
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
- –ó–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö

–î–≤–µ –±–∞–∑—ã –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è:
- –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ (–º–∏–ª–ª–∏–æ–Ω—ã –∑–∞–ø—Ä–æ—Å–æ–≤)
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –°–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

–î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ–¥–Ω–æ–π –±–∞–∑—ã –±–æ–ª–µ–µ —á–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ! üöÄ
