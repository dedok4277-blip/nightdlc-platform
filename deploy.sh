#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ Timeweb

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –¥–µ–ø–ª–æ–π NightDLC..."

# 1. –°–æ–±–∏—Ä–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
echo "üì¶ –°–±–æ—Ä–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞..."
npm run build

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞"
    exit 1
fi

echo "‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–±—Ä–∞–Ω —É—Å–ø–µ—à–Ω–æ"

# 2. –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (–∏—Å–∫–ª—é—á–∞—è node_modules)
echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞..."
tar -czf deploy.tar.gz \
    --exclude='node_modules' \
    --exclude='.git' \
    --exclude='*.log' \
    --exclude='deploy.tar.gz' \
    .

echo "‚úÖ –ê—Ä—Ö–∏–≤ —Å–æ–∑–¥–∞–Ω: deploy.tar.gz"

echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ deploy.tar.gz –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ FTP/SFTP"
echo "2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –ø–æ SSH: ssh cz505339@cz505339.tw1.ru"
echo "3. –†–∞—Å–ø–∞–∫—É–π—Ç–µ: tar -xzf deploy.tar.gz"
echo "4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: npm install --production"
echo "5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: pm2 start ecosystem.config.js"
echo ""
echo "–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏:"
echo "scp deploy.tar.gz cz505339@cz505339.tw1.ru:~/cz505339.tw1.ru/public_html/"
